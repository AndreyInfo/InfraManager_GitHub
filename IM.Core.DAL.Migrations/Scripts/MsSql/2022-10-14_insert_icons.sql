DECLARE @state int =0;
DECLARE @errorname nvarchar(max)
BEGIN TRAN --чтобы не повредить базу
BEGIN TRY
    if (NOT EXISTS(SELECT top 1 0
                   FROM INFORMATION_SCHEMA.TABLES
                   WHERE TABLE_SCHEMA = 'dbo'
                     AND TABLE_NAME like 'Icons'))
        begin
            create table icons
            (
                id   uniqueidentifier primary key default newid(),
                name varchar(50) not null unique
            );
            insert into icons (id, name)
            values ('db68f165-53d6-49a1-b1bf-44b057511f3a', 'SvgAdapter'),
                   ('73ad0857-885b-4eb4-a426-104b31d141f3', 'SvgOpenDirectory'),
                   ('0bfc94cb-0011-49e3-a288-49ef033db1d6', 'SVGCharacteristics'),
                   ('acb7b27a-d592-48c9-b102-e31a94898f61', 'SvgArrow'),
                   ('f1075d33-ce98-4124-a929-c61dabfec26e', 'SvgArrowFilled'),
                   ('8b58e237-dd28-4679-b914-061e703e972a', 'SvgArrowRight'),
                   ('b7c5a30d-8a3e-4392-80f0-3388bb02d23b', 'SvgAssets'),
                   ('c1875faa-bc0d-414f-aba9-9c7c18e574fb', 'SvgBigFinance'),
                   ('cb66fffd-6f8c-460a-aa98-7e7b6621f77e', 'SvgBigGroup'),
                   ('dac62bc4-3ab9-4fe9-8718-fffe888f1a10', 'SvgBigPalette'),
                   ('a6297991-640d-47be-b911-ab5970a579fd', 'SvgBigStar'),
                   ('34c4352b-f20e-47ae-acb2-8d93bb839247', 'SvgBigTrashcan'),
                   ('d542bc91-1852-4538-90f2-493e844b6b25', 'SvgBigWork'),
                   ('b1f0b020-2324-4124-9712-3c07a02114ad', 'SvgBlockPlus'),
                   ('20e649dc-ae30-41cf-acc8-a0410b1bdfe1', 'SvgBlueMinus'),
                   ('300b31ca-8046-497d-b186-c09196d9410f', 'SvgBluePlus'),
                   ('15b726a8-1091-4ee7-a697-4419548bda45', 'SvgBomb'),
                   ('cd59bc16-936c-468b-8705-b3382a7f2577', 'SvgBookmark'),
                   ('733fc7ef-1573-45bf-9230-3069e16c16eb', 'SvgBox'),
                   ('139c250d-2d2a-4e0b-8f35-eb44f7402f6f', 'SvgBrush'),
                   ('675b49af-f611-4ec6-a13f-51298c3c27ea', 'SvgCalendar'),
                   ('2fc70a30-cce4-406c-bcde-ec5df28c0541', 'SvgCallObject'),
                   ('c6f984b7-f891-4d40-8d72-6ed654358f54', 'SvgCatalog'),
                   ('1adda1a9-2ac3-4851-8a21-3eb4fa6fd85e', 'SvgCatalogProducts'),
                   ('1e047289-cadb-4576-ba7a-ab562c78f0ec', 'SvgCategory'),
                   ('4144b470-4a73-42a1-904a-18976050f9b9', 'SvgChain'),
                   ('dce73ab1-2f57-496f-910c-359ec8ecad68', 'SvgChecked'),
                   ('17055630-95ad-45c0-991b-46b9ffdb5087', 'SvgCircleAdd'),
                   ('28529026-0f34-4877-8084-8ea248a418ce', 'SvgClip'),
                   ('a9ecf57d-06a1-4e1a-97d9-383f11eccf23', 'SvgClone'),
                   ('04ce1179-b296-4073-89b8-4cbf3918d8dd', 'SvgConditionJoin'),
                   ('755196ab-4c43-4a66-b8fd-26640fc3c240', 'SvgConditionLeave'),
                   ('765ae6f1-6b71-4c27-af70-c83830c5c500', 'SvgCopy'),
                   ('c40f7ed7-1744-442b-98c3-583dfa1412b2', 'SvgCross'),
                   ('12dd4349-46b9-4539-b228-3c1fb0d0f512', 'SvgTabGeneral'),
                   ('8af4aee1-05a6-4f12-b9f7-85709ec1d94c', 'SvgDatabase'),
                   ('493f359c-7285-4bf4-a6ca-aaf62239ff0d', 'SvgDesktop'),
                   ('6269db4a-6b9b-4b37-a53a-76c7cb078712', 'SvgDiscovery'),
                   ('2e954a0e-5b54-4d4d-ae9e-180a0d470530', 'SvgDocument'),
                   ('10789f8f-1035-49dc-ab80-9bbd7904dcb9', 'SvgDownload'),
                   ('5fa8585f-539a-49c9-8e7f-f03aa2db7895', 'SvgDrivenEvent'),
                   ('37f57fe9-825c-44d4-9501-32b354bf578f', 'SvgEdit'),
                   ('986ae61c-c5a6-412e-a5e5-844e9466209e', 'SvgEditPen'),
                   ('711622d1-7732-4510-a1b8-fecb8e955ef1', 'SvgElementPicker'),
                   ('14896136-be7f-43dc-a577-4ee44da8ad92', 'SvgExcel'),
                   ('b96bdc3b-2567-4a15-9fca-949c2006316a', 'SvgExistEvent'),
                   ('fa1520f7-8383-4bf2-a836-056a579a4fdc', 'SvgFile'),
                   ('3139d655-844e-41b4-951e-469a0858a53b', 'SvgFilter'),
                   ('5cc40a77-1bad-48db-9185-7e6cc115f5dd', 'SvgFilterActive'),
                   ('9a7aee71-5e51-4c7b-9abc-54a71eb9942a', 'SvgFinance'),
                   ('86c3e2cd-7080-42c2-8d2e-33b746cc7aba', 'SvgFlagEn'),
                   ('48f2dbbf-7010-46b7-a9b6-6414c0623792', 'SvgFlagRu'),
                   ('d431dde4-c9f1-4276-a794-159ed0ba3914', 'SvgForm'),
                   ('39b81530-677c-46c7-96a3-328ed4f2118a', 'SvgKey'),
                   ('35d981c7-5937-4cec-b516-a3542db4ac83', 'SvgGroup'),
                   ('824da1ca-87a9-435f-9ffe-8e4dedd27796', 'SvgHandlerDrag'),
                   ('8aa9f840-5834-4166-a9f4-3f319db59011', 'SvgHide'),
                   ('742e2b90-2caa-42f3-bbee-90a2725e285a', 'SvgHistory'),
                   ('5708d8d3-86cd-4aca-b315-72c99ec602ef', 'SvgImageZero'),
                   ('b17c0942-782e-4bd9-b829-c489181b5176', 'SvgInfo'),
                   ('f67f579f-8092-4ca1-9839-b9ddbf892660', 'SvgInstalls'),
                   ('d597694d-7ca9-4abd-bbc9-a6f8fd27a823', 'SvgIntegration'),
                   ('de7542d5-94a0-4aed-9459-e72fbe560f6c', 'SvgLock'),
                   ('eeddb41a-b457-4235-b120-72505ed82bcf', 'SvgLocked'),
                   ('feda2697-4d08-4816-a1ac-45d255e8204c', 'SvgLogo'),
                   ('2a0f0d92-2b5b-4b26-a93b-d3119f1c43e4', 'SvgLoupe'),
                   ('4f0c3b1e-4e14-4cdb-8366-1ff5402fc0a4', 'SvgLoupPoll'),
                   ('3c465e75-a0d0-4d7b-8e74-4db60cac56af', 'SvgMail'),
                   ('b7fa2f9d-678d-4520-a3b4-5753bba4d410', 'SvgMailSetup'),
                   ('3138cd71-4b1c-4849-adcf-14de2cac8dbb', 'SvgMainLogo'),
                   ('8fa12d27-f2cd-44f8-958b-c321fbc15e72', 'SvgMap'),
                   ('95657f3b-f696-4734-ba5c-ab79496c3896', 'SvgMaximize'),
                   ('5f0326a3-5d4c-40d3-aa1a-4ecd13fefd23', 'SvgMenuCalendar'),
                   ('ecf53d97-1ac8-4765-a796-9aeb7a8cb825', 'SvgMessage'),
                   ('91f9cb4d-0298-4b20-b047-41f11fea00b1', 'SvgMinimize'),
                   ('c995fe38-38ae-4099-abda-fdeb8a912ec4', 'SvgMore'),
                   ('7575d0e8-4598-467b-9920-b72c099bbc7c', 'SvgObject'),
                   ('b4c7a09e-4659-4cec-8388-f46bdbb52f3f', 'SvgOpenCard'),
                   ('f9f1abba-b311-4f00-b12e-656b775e5af9', 'SvgOpenEvent'),
                   ('43e554f6-d134-4463-a2d0-0ee59a1ec291', 'SvgOrgstructure'),
                   ('9f63eaef-9c51-4aa4-b1fa-d7f95082cfe6', 'SvgPalette'),
                   ('4a384157-e2d6-4c28-97bc-dde96eadba2a', 'SvgPhone'),
                   ('3ae5b141-58b8-483d-a566-27670ca98a0b', 'SvgPlus'),
                   ('b952625f-58b6-4914-86f6-ec19eca43c50', 'SvgTrash'),
                   ('eb4914d9-50e5-47f2-a31c-9d9d8cfdce20', 'SvgPort'),
                   ('a131c58e-5a40-4955-8b94-9ec8b505f7b5', 'SvgPreview'),
                   ('4bc87c0f-c1a8-411e-97b7-79cfa1d8a150', 'SvgPrint'),
                   ('08a08857-7d36-4024-b30d-405b6e2f13fe', 'SvgProcess'),
                   ('43ee76e9-61e3-4f78-b605-b06ca6763382', 'SvgProperties'),
                   ('f7f661eb-850b-4e6c-a844-cbc5d172feaa', 'SvgProperty'),
                   ('59162b6e-f2bd-497c-9bbe-3b0eee1fc8f7', 'SvgPublish'),
                   ('286b39cf-8b7b-46e8-9eb4-387f8ee254ca', 'SvgRoles'),
                   ('08001f83-b7e1-4318-93da-db00c0456a14', 'SvgSave'),
                   ('5cbbcd15-33f2-43f8-96a3-2a984d5e0b18', 'SvgSearch'),
                   ('f54efc8a-b945-4f8e-a7a1-c9c97c68ba48', 'SvgSearchField'),
                   ('e3cd7f09-3a24-42c7-8f7d-d644af6a2a7d', 'SvgServices'),
                   ('33b22f14-89ec-4b1f-8e24-9059bd53f49c', 'SvgSettings'),
                   ('1abcb578-20c7-4503-9f7e-b51800492ccf', 'SvgShow'),
                   ('eb01b05a-5780-4126-8626-85ddd12b7ed6', 'SvgSlot'),
                   ('7cb25faf-03c0-4447-a737-e19468c30cc0', 'SvgSmallArrowFilled'),
                   ('157d10b9-af40-4b2a-96ad-a55caed5d177', 'SvgSmallCalendar'),
                   ('5326ce3a-eb50-4e41-b406-abcdd3e8d966', 'SvgSmallClip'),
                   ('f6c47555-01cd-4350-bea8-56e24003badb', 'SvgSmallCross'),
                   ('9978a638-7ce7-424c-b4f2-7bb76c897cea', 'SvgSmallMap'),
                   ('f511212e-b18b-45a9-9322-59c533721acc', 'SvgSoftware'),
                   ('80a3cbfc-33c2-4ad8-881f-eac165437acc', 'SvgStatusBlocked'),
                   ('b0cc0906-a2b6-4ecf-8c7b-82211028d850', 'SvgStatusCreated'),
                   ('7b24cd0a-ae0e-4240-bd23-c904ad1fd760', 'SvgStatusError'),
                   ('23858804-f5da-4294-af3d-4e0fde7fd105', 'SvgStatusModified'),
                   ('8b4e884a-f4ec-407a-8e51-7179a9e81219', 'SvgStatusPublish'),
                   ('79efe406-2524-4b34-a3f9-1d1c2a69805a', 'SvgStatusSuccess'),
                   ('80821d95-165d-40dc-a6ae-19826ac7364a', 'SvgStorage'),
                   ('6ec1ce27-18b0-4dce-9045-6acbc7bfe23e', 'SvgSuitcase'),
                   ('f7aafc9a-abb5-40b8-b228-3e8de6bd9a31', 'SvgSymbolMail'),
                   ('8bbb9beb-aec1-42cd-a0c1-615151f7cf19', 'SvgTabCalendar'),
                   ('f6d6f010-03c3-46b8-b24c-cc4502201c78', 'SvgTabComputer'),
                   ('2accb55e-9a86-453d-943c-e8ea96930130', 'SvgTabDocument'),
                   ('0c54d898-b620-4ea6-b3fb-0aec0f0f994a', 'SvgTabLink'),
                   ('bdcdc668-bac2-4590-8d52-00cee9e2cce7', 'SvgTabMap'),
                   ('61358d0d-5515-46d0-9373-87cf115f63c7', 'SvgTabProcedures'),
                   ('5c2dfeb8-c226-4c2d-92ce-5892c9400d0e', 'SvgTabSynonyms'),
                   ('070cdfc2-5afe-45fd-b278-b37823d0201d', 'SvgTabZero'),
                   ('2143a662-f8d8-4f91-a25d-ce4b618a5b70', 'SvgTime'),
                   ('0770f831-ce2e-4af8-bff7-a06d2a7840c3', 'SvgTrashcan'),
                   ('6b42a30e-352b-4137-bc87-673c3b508e63', 'SvgTreeApi'),
                   ('eb3a963b-784b-4f0b-acdc-7fb516c36838', 'SvgTreeApp'),
                   ('24f246d2-370c-459d-84a9-9084819b284c', 'SvgTreeArrow'),
                   ('b486e87b-8b0c-46bf-9e74-dcb25ebb20a0', 'SvgTreeBlock'),
                   ('c4c97bcc-dabf-48e0-b820-57f98b588b7d', 'SvgTreeBomb'),
                   ('855d529f-c040-4f1d-84a4-79f112d17d04', 'SvgTreeBookmark'),
                   ('ab8a8291-a8e9-4715-9d33-24249a9f32c0', 'SvgTreeBookmarkModel'),
                   ('7f5ac256-1d71-437d-ae5f-79427df36680', 'SvgTreeBox'),
                   ('bd470582-3d17-4987-8acf-d53f5f93dd48', 'SvgTreeBreafcase'),
                   ('991f2744-a493-4478-82cb-cb64cc354d3c', 'SvgTreeBug'),
                   ('419a0f46-7222-4e02-96d0-3470f06d3d7f', 'SvgTreeBuilding'),
                   ('1db528dc-5201-419d-a1e5-e08d3254ac9c', 'SvgTreeCart'),
                   ('f16cbcd6-d403-4bb0-91b3-3ceda0c66e1e', 'SvgTreeChanges'),
                   ('71ab219c-29bd-4cec-9d84-71d9d821de6f', 'SvgTreeChartVertical'),
                   ('1eec598f-6cf8-4ed4-8f95-627f64fc63c5', 'SvgTreeChartsHorizontal'),
                   ('ea005cbc-f39f-44ae-a429-8489e31112e9', 'SvgTreeCloset'),
                   ('416671ae-43f5-4711-aa90-6abd0f4cb6a4', 'SvgTreeCode'),
                   ('5273f57d-e75e-4691-8e8f-6811980d9421', 'SvgTreeCodeModel'),
                   ('5b272246-b5ff-46cc-afd4-793eeda055ae', 'SvgTreeComputer'),
                   ('150d57ed-a945-4be3-8608-96b9d8f35fe2', 'SvgTreeComputerModel'),
                   ('2254d0a9-1794-4841-899f-ea5250ad3175', 'SvgTreeCube'),
                   ('64d77482-859e-4615-b0f5-1f48bfc9c894', 'SvgTreeDB'),
                   ('6eec68ac-381b-44bf-8e2c-b55e784db8f6', 'SvgTreeDiagram'),
                   ('1da3ab1e-48be-4d8e-af25-5f4e74f53141', 'SvgTreeEmpty'),
                   ('871a2e9f-6493-437d-a61e-656d8a437181', 'SvgTreeFloor'),
                   ('e97f51ec-cfce-4d1f-a3c9-bd75f29f8e84', 'SvgTreeFolder'),
                   ('643cad97-6541-40e8-8eb9-94725cf35dc9', 'SvgTreeForm'),
                   ('cf865fbd-b26d-4104-81c0-84dd34a5e5ce', 'SvgTreeGroup'),
                   ('075c0ca6-44a1-45ac-976b-e9cc95a55e0b', 'SvgTreeHammer'),
                   ('9b85e9c7-8720-4fbe-bdc9-0b478af6ab48', 'SvgTreeITSystem'),
                   ('f9ffd547-71f3-4169-aff5-56108bf020f1', 'SvgTreeImportUsers'),
                   ('71b83c11-8b46-4828-b1c9-396a9f7482b0', 'SvgTreeInstalls'),
                   ('7e8e447b-cfbc-4a56-b1f4-4d20e9453e87', 'SvgTreeInventory'),
                   ('38806504-2485-4242-abbb-3fdf1ab7a03e', 'SvgTreeLifeCycle'),
                   ('f340dc2d-9036-4387-a88e-322d83f5e039', 'SvgTreeMonitor'),
                   ('54a05686-5226-4787-919c-c69603e0d2ab', 'SvgTreeMonitorModel'),
                   ('3d366ac2-0e6b-4565-a8bd-b54ca627e792', 'SvgTreeOrganization'),
                   ('b8f4f947-4413-43e1-b1b7-9eabb7b52ec7', 'SvgTreeOrgstructure'),
                   ('f72133d0-0a38-4e5e-b74d-f679bd106fb3', 'SvgTreeOwner'),
                   ('31028d6b-011f-4aff-b3bc-f36f2805d34a', 'SvgTreeParameters'),
                   ('43b6d468-2463-4337-8293-ef7a7a9c428a', 'SvgTreePhone'),
                   ('d7591b12-7ba2-414f-a47b-06d31bcb532b', 'SvgTreeProcessor'),
                   ('83c3ff56-0850-40b2-a407-1af95430d4e0', 'SvgTreeProcessorModel'),
                   ('e48dec6c-576f-47cc-a9c8-734b416bae23', 'SvgTreeProject'),
                   ('ff6013b6-918f-4296-b3bb-4537425851ed', 'SvgTreePurchases'),
                   ('8267e9c0-4ded-4d5f-aa36-c9b03e5935de', 'SvgTreeQuestion'),
                   ('cea903cf-9021-44f9-98de-62168e6d150b', 'SvgTreeRoom'),
                   ('305ae225-795b-4427-bf00-5cdaaee38884', 'SvgTreeRuble'),
                   ('a740d94f-0b9a-416c-b3db-90d49471ea42', 'SvgTreeRubleModel'),
                   ('0c841ff3-17db-4d6e-85bd-ff800cea03ec', 'SvgTreeSLA'),
                   ('05e5ffeb-f8a9-4d53-a70f-208da429f528', 'SvgTreeScissorsModel'),
                   ('f95a60fa-ba2c-4bd6-b2d0-063e9735353b', 'SvgTreeServer'),
                   ('ba340dd6-9fc3-47d9-bf11-ecef13d2bbb1', 'SvgTreeServerModel'),
                   ('a928067a-c909-4f65-ba16-bdbbf884fb91', 'SvgTreeSettings'),
                   ('d59b26cb-a83e-4cf2-8e53-34cbe6d871d2', 'SvgTreeSoftwareCatalog'),
                   ('77b87241-a17b-4af7-8fb7-414b78cb1bdb', 'SvgTreeSubdivision'),
                   ('4fa0ee2e-5bb7-4b80-95a7-332a1cbede5d', 'SvgTreeSun'),
                   ('88d04207-6ae5-421c-adc4-1af424be3c78', 'SvgTreeThunder'),
                   ('8d0c23f0-fd26-4c03-825f-c6d752bd2699', 'SvgTreeUser'),
                   ('96e740cb-d060-40a8-bfec-a4be4e8d8cb2', 'SvgTreeWorkplace'),
                   ('44a8a483-4d97-48d8-adb0-2b4e83e41c47', 'SvgTreeWrench'),
                   ('b70d2fbb-b1f8-49cc-a244-de10a8f1a7ad', 'SvgTypes'),
                   ('93daccbe-0da9-415b-9e80-471b31392fa4', 'SvgUnload'),
                   ('9cf4e4bd-c039-4549-b14b-d7ded7a07e1b', 'SvgUpdate'),
                   ('6b24cc22-bf6c-491f-bc7e-b93a6e0b6694', 'SvgUser'),
                   ('0e39188b-a70f-46ee-b9bc-4268d13f9801', 'SvgUserImport'),
                   ('7cf10c31-ce0d-4585-b53d-d68177c58c9e', 'SvgUsers'),
                   ('6a283425-c7d3-4f72-8a4f-7996e6b8b895', 'SvgWarning'),
                   ('89a249ad-6070-43ca-9b3f-1e81a229114d', 'SvgWind'),
                   ('60aa11c3-8f11-4185-bb78-b9e3af1ead01', 'SvgWork'),
                   ('048e8314-0c18-4039-a168-fa85275a19b1', 'SvgWorkflow'),
                   ('67fc60c5-f17e-447c-824d-0ae29819df08', 'SvgWorkflowConnector'),
                   ('71df21b2-a908-4ba2-8a7c-cabb8c296920', 'SvgWorkflowHandler'),
                   ('d77cecec-76c4-4689-9e8b-29ae6050378b', 'SvgWorkflowPalette'),
                   ('a327c442-2def-412c-83a0-702e6cd3ac6a', 'SvgWorkflowStateOpen')

            alter table ProductCatalogCategory
                add IconID uniqueidentifier references icons (id) default '73ad0857-885b-4eb4-a426-104b31d141f3' NOT NULL
            alter table ProductCatalogType
                add IconID uniqueidentifier references icons (id) default 'db68f165-53d6-49a1-b1bf-44b057511f3a' NOT NULL
        end
END TRY
BEGIN CATCH
    SET @state = 1;
    SET @errorname = ERROR_MESSAGE()
END CATCH
IF (@state = 1)
    BEGIN
        IF @@TRANCOUNT > 0
            ROLLBACK;
        THROW 51001,@errorname,1; -- в скрипте ошибка требующая внимания
    end
ELSE
    BEGIN
        IF @@TRANCOUNT > 0
            commit
    END


